<Window x:Class="UI.Views.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:oxy="http://oxyplot.org/wpf"
        xmlns:vm="clr-namespace:UI.ViewModels"
        mc:Ignorable="d"
        Title="МНК Аппроксимация данных полиномом 2-й степени"
        Height="800"
        Width="1200"
        MinHeight="700"
        MinWidth="900"
        WindowStartupLocation="CenterScreen">

	<Window.DataContext>
		<vm:MainViewModel />
	</Window.DataContext>

	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
			<RowDefinition Height="Auto"/>
		</Grid.RowDefinitions>
		<Grid.ColumnDefinitions>
			<ColumnDefinition Width="*"/>
			<ColumnDefinition Width="300"/>
		</Grid.ColumnDefinitions>

		<!-- Панель управления -->
		<Border Grid.Row="0" Grid.ColumnSpan="2"
                Background="LightSteelBlue"
                Padding="15"
                BorderBrush="SteelBlue"
                BorderThickness="0,0,0,2">
			<Grid>
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="Auto"/>
					<ColumnDefinition Width="*"/>
					<ColumnDefinition Width="Auto"/>
					<ColumnDefinition Width="100"/>
					<ColumnDefinition Width="Auto"/>
				</Grid.ColumnDefinitions>

				<Grid.RowDefinitions>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="8"/>
					<RowDefinition Height="Auto"/>
				</Grid.RowDefinitions>

				<!-- Выбор набора данных -->
				<Label Grid.Column="0" Grid.Row="0"
                       Content="Набор данных:"
                       VerticalAlignment="Center"
                       FontWeight="Bold"
                       Foreground="DarkSlateGray"/>

				<ComboBox Grid.Column="1" Grid.Row="0"
                          ItemsSource="{Binding DataSets}"
                          SelectedItem="{Binding SelectedDataSet}"
                          DisplayMemberPath="Name"
                          Margin="10,0,20,0"
                          VerticalAlignment="Center"
                          FontSize="12"
                          MinWidth="250"/>

				<!-- Количество точек аппроксимации -->
				<Label Grid.Column="2" Grid.Row="0"
                       Content="Точек:"
                       VerticalAlignment="Center"
                       FontWeight="Bold"
                       Foreground="DarkSlateGray"/>

				<TextBox Grid.Column="3" Grid.Row="0"
                         Text="{Binding ApproximationPoints, UpdateSourceTrigger=PropertyChanged}"
                         VerticalAlignment="Center"
                         HorizontalContentAlignment="Center"
                         FontSize="12"
                         Margin="5,0"/>

				<!-- Кнопка обновления -->
				<Button Grid.Column="4" Grid.Row="0"
                        Content="Обновить"
                        Command="{Binding UpdatePlotCommand}"
                        Padding="15,8"
                        Margin="10,0,0,0"
                        Background="SteelBlue"
                        Foreground="White"
                        FontWeight="Bold"
                        Cursor="Hand"/>

				<!-- Описание выбранного набора -->
				<TextBlock Grid.Column="0" Grid.Row="2"
                           Grid.ColumnSpan="5"
                           Text="{Binding SelectedDataSet.Description}"
                           FontStyle="Italic"
                           Foreground="DarkSlateGray"
                           TextWrapping="Wrap"/>
			</Grid>
		</Border>

		<!-- График -->
		<oxy:PlotView Grid.Row="1" Grid.Column="0"
                      Model="{Binding PlotModel}"
                      Margin="15"
                      Background="White"
                      BorderBrush="LightGray"
                      BorderThickness="1"/>

		<!-- Панель с коэффициентами -->
		<Border Grid.Row="1" Grid.Column="1"
                Background="WhiteSmoke"
                BorderBrush="LightGray"
                BorderThickness="1,0,0,0"
                Padding="15">

			<ScrollViewer VerticalScrollBarVisibility="Auto">
				<StackPanel>
					<!-- Заголовок -->
					<TextBlock Text="Результаты аппроксимации"
                               FontSize="16"
                               FontWeight="Bold"
                               Foreground="DarkSlateGray"
                               Margin="0,0,0,15"
                               HorizontalAlignment="Center"/>

					<!-- Уравнение полинома -->
					<GroupBox Header="Уравнение полинома"
                              Margin="0,0,0,15"
                              Foreground="DarkSlateGray">
						<TextBlock Text="{Binding PolynomialEquation}"
                                   FontFamily="Consolas"
                                   FontSize="12"
                                   Background="White"
                                   Padding="8"
                                   TextWrapping="Wrap"
                                   HorizontalAlignment="Center"/>
					</GroupBox>

					<!-- Коэффициенты -->
					<GroupBox Header="Коэффициенты"
                              Margin="0,0,0,15"
                              Foreground="DarkSlateGray">
						<Grid>
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="Auto"/>
								<ColumnDefinition Width="*"/>
							</Grid.ColumnDefinitions>
							<Grid.RowDefinitions>
								<RowDefinition Height="Auto"/>
								<RowDefinition Height="Auto"/>
								<RowDefinition Height="Auto"/>
							</Grid.RowDefinitions>

							<Label Grid.Row="0" Grid.Column="0" Content="a (константа):" FontWeight="Bold"/>
							<TextBox Grid.Row="0" Grid.Column="1"
                                     Text="{Binding CoefficientA, Mode=OneWay}"
                                     IsReadOnly="True"
                                     FontFamily="Consolas"
                                     Background="White"
                                     Margin="5,2"/>

							<Label Grid.Row="1" Grid.Column="0" Content="b (при x):" FontWeight="Bold"/>
							<TextBox Grid.Row="1" Grid.Column="1"
                                     Text="{Binding CoefficientB, Mode=OneWay}"
                                     IsReadOnly="True"
                                     FontFamily="Consolas"
                                     Background="White"
                                     Margin="5,2"/>

							<Label Grid.Row="2" Grid.Column="0" Content="c (при x²):" FontWeight="Bold"/>
							<TextBox Grid.Row="2" Grid.Column="1"
                                     Text="{Binding CoefficientC, Mode=OneWay}"
                                     IsReadOnly="True"
                                     FontFamily="Consolas"
                                     Background="White"
                                     Margin="5,2"/>
						</Grid>
					</GroupBox>

					<!-- Статистика качества -->
					<GroupBox Header="Качество аппроксимации"
                              Margin="0,0,0,15"
                              Foreground="DarkSlateGray">
						<Grid>
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="Auto"/>
								<ColumnDefinition Width="*"/>
							</Grid.ColumnDefinitions>
							<Grid.RowDefinitions>
								<RowDefinition Height="Auto"/>
								<RowDefinition Height="Auto"/>
							</Grid.RowDefinitions>

							<Label Grid.Row="0" Grid.Column="0" Content="R² (детерминация):" FontWeight="Bold"/>
							<TextBox Grid.Row="0" Grid.Column="1"
                                     Text="{Binding RSquared, Mode=OneWay}"
                                     IsReadOnly="True"
                                     FontFamily="Consolas"
                                     Background="White"
                                     Margin="5,2"/>

							<Label Grid.Row="1" Grid.Column="0" Content="RMSE (среднекв. ошибка):" FontWeight="Bold"/>
							<TextBox Grid.Row="1" Grid.Column="1"
                                     Text="{Binding RMSE, Mode=OneWay}"
                                     IsReadOnly="True"
                                     FontFamily="Consolas"
                                     Background="White"
                                     Margin="5,2"/>
						</Grid>
					</GroupBox>

					<!-- Информация о методе -->
					<GroupBox Header="О методе МНК"
                              Foreground="DarkSlateGray">
						<TextBlock TextWrapping="Wrap"
                                   Margin="5"
                                   FontSize="11"
                                   Foreground="Gray">
							<Run Text="Метод наименьших квадратов минимизирует сумму квадратов отклонений экспериментальных точек от аппроксимирующей кривой."/>
							<LineBreak/>
							<LineBreak/>
							<Run Text="Полином: y = a + bx + cx²"/>
							<LineBreak/>
							<LineBreak/>
							<Run Text="R² близкий к 1 означает хорошую аппроксимацию."/>
							<LineBreak/>
							<Run Text="RMSE показывает среднее отклонение от модели."/>
						</TextBlock>
					</GroupBox>
				</StackPanel>
			</ScrollViewer>
		</Border>

		<!-- Статус бар -->
		<StatusBar Grid.Row="2" Grid.ColumnSpan="2"
                   Background="LightGray"
                   BorderBrush="Gray"
                   BorderThickness="0,1,0,0">
			<StatusBar.ItemsPanel>
				<ItemsPanelTemplate>
					<Grid>
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="Auto"/>
							<ColumnDefinition Width="Auto"/>
							<ColumnDefinition Width="Auto"/>
						</Grid.ColumnDefinitions>
					</Grid>
				</ItemsPanelTemplate>
			</StatusBar.ItemsPanel>

			<StatusBarItem Grid.Column="0">
				<TextBlock>
					<Run Text="МНК - Метод наименьших квадратов для полиномиальной аппроксимации 2-й степени"/>
				</TextBlock>
			</StatusBarItem>

			<StatusBarItem Grid.Column="1">
				<TextBlock Margin="15,0">
					<Run Text="Точек данных: "/>
					<Run Text="{Binding SelectedDataSet.Points.Length, Mode=OneWay, FallbackValue=0}" FontWeight="Bold"/>
				</TextBlock>
			</StatusBarItem>

			<StatusBarItem Grid.Column="2">
				<TextBlock Margin="15,0">
					<Run Text="R²: "/>
					<Run Text="{Binding RSquared, Mode=OneWay}" FontWeight="Bold"/>
				</TextBlock>
			</StatusBarItem>

			<StatusBarItem Grid.Column="3">
				<TextBlock Margin="15,0">
					<Run Text="RMSE: "/>
					<Run Text="{Binding RMSE, Mode=OneWay}" FontWeight="Bold"/>
				</TextBlock>
			</StatusBarItem>
		</StatusBar>
	</Grid>
</Window>